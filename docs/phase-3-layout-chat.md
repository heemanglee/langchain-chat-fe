# Phase 3: ë©”ì¸ ë ˆì´ì•„ì›ƒ + ì±„íŒ… (SSE ìŠ¤íŠ¸ë¦¬ë°)

## ëª©í‘œ

ì‚¬ì´ë“œë°”ë¥¼ í¬í•¨í•œ ë©”ì¸ ì•± ë ˆì´ì•„ì›ƒì„ êµ¬ì„±í•˜ê³ , SSE ê¸°ë°˜ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì±„íŒ… ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤.

## ì˜ì¡´ API

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| POST | `/api/v1/chat/stream` | SSE ìŠ¤íŠ¸ë¦¬ë° ì±„íŒ… |
| POST | `/api/v1/chat` | ë™ê¸° ì±„íŒ… (í´ë°±) |
| GET | `/api/v1/conversations` | ëŒ€í™” ëª©ë¡ (ì»¤ì„œ í˜ì´ì§€ë„¤ì´ì…˜) |

### ì±„íŒ… ìš”ì²­/ì‘ë‹µ

```typescript
// Request
interface ChatRequest {
  message: string           // 1-4000ì
  conversation_id?: string  // ê¸°ì¡´ ëŒ€í™” ID (ì—†ìœ¼ë©´ ìƒˆ ëŒ€í™” ìƒì„±)
  use_web_search?: boolean  // ì›¹ ê²€ìƒ‰ ì‚¬ìš© ì—¬ë¶€ (ê¸°ë³¸: true)
}

// SSE ì´ë²¤íŠ¸ íƒ€ì…
type StreamEventType = 'token' | 'tool_call' | 'tool_result' | 'done' | 'error'

// SSE ì´ë²¤íŠ¸ ë°ì´í„°
interface StreamEvent {
  event: StreamEventType
  data: string  // JSON ë¬¸ìì—´
}
```

### ëŒ€í™” ëª©ë¡ ì‘ë‹µ

```typescript
interface ConversationSummary {
  conversation_id: string
  title: string | null
  last_message_preview: string | null
  created_at: string
  updated_at: string
}

interface ConversationListResponse {
  conversations: ConversationSummary[]
  next_cursor: string | null
  has_next: boolean
}
```

## ì‘ì—… ëª©ë¡

### 3.1 ë©”ì¸ ì•± ë ˆì´ì•„ì›ƒ (`AppLayout`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Navbar                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â”   â”‚
â”‚  â”‚ Logoâ”‚                           â”‚ğŸ”â”‚ â”‚ğŸŒ“â”‚ â”‚ğŸ‘¤â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          â”‚                                           â”‚
â”‚ Sidebar  â”‚              <Outlet />                   â”‚
â”‚ (280px)  â”‚                                           â”‚
â”‚          â”‚                                           â”‚
â”‚          â”‚                                           â”‚
â”‚          â”‚                                           â”‚
â”‚          â”‚                                           â”‚
â”‚          â”‚                                           â”‚
â”‚          â”‚                                           â”‚
â”‚          â”‚                                           â”‚
â”‚          â”‚                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
```

**Navbar êµ¬ì„± ìš”ì†Œ:**
- ì™¼ìª½: ë¡œê³  (â—RAG.OS) + ì‚¬ì´ë“œë°” í† ê¸€ ë²„íŠ¼
- ì˜¤ë¥¸ìª½: í…Œë§ˆ ì „í™˜ ë²„íŠ¼, ì‚¬ìš©ì ì•„ë°”íƒ€/ë“œë¡­ë‹¤ìš´

**ì‚¬ì´ë“œë°” ë™ì‘:**
- ê¸°ë³¸ ë„ˆë¹„: 280px
- ëª¨ë°”ì¼ì—ì„œ: ì˜¤ë²„ë ˆì´ë¡œ í‘œì‹œ
- í† ê¸€ ë²„íŠ¼ìœ¼ë¡œ ì ‘ê¸°/í¼ì¹˜ê¸°

### 3.2 ì‚¬ì´ë“œë°” ì»´í¬ë„ŒíŠ¸

ì‚¬ì´ë“œë°”ëŠ” ì•„ë˜ ì„¹ì…˜ìœ¼ë¡œ êµ¬ì„±ëœë‹¤. í˜„ì¬ ë‹¨ê³„ì—ì„œëŠ” **RECENT SESSIONS** ì„¹ì…˜ë§Œ í™œì„±í™”í•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” Phase 4ì—ì„œ êµ¬í˜„í•œë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ + ìƒˆ ì±„íŒ…     â”‚    â”‚  â† ìƒˆ ëŒ€í™” ìƒì„± ë²„íŠ¼
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                      â”‚
â”‚  LIBRARY             â”‚  â† Phase 4ì—ì„œ í™œì„±í™”
â”‚  â”œâ”€â”€ ëª¨ë“  ë¬¸ì„œ        â”‚
â”‚  â””â”€â”€ ìµœê·¼ ì—…ë¡œë“œ      â”‚
â”‚                      â”‚
â”‚  AGENTS              â”‚  â† Phase 4ì—ì„œ í™œì„±í™”
â”‚  â”œâ”€â”€ (ì—ì´ì „íŠ¸ ëª©ë¡)   â”‚
â”‚                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                      â”‚
â”‚  RECENT              â”‚  â† ì´ ë‹¨ê³„ì—ì„œ êµ¬í˜„
â”‚  â”œâ”€â”€ ëŒ€í™” ì œëª© 1      â”‚
â”‚  â”œâ”€â”€ ëŒ€í™” ì œëª© 2      â”‚
â”‚  â””â”€â”€ ë” ë³´ê¸°...       â”‚  â† ë¬´í•œ ìŠ¤í¬ë¡¤
â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ëŒ€í™” ëª©ë¡:**
- `GET /api/v1/conversations`ë¡œ ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§€ë„¤ì´ì…˜
- `useInfiniteQuery`ë¡œ ë¬´í•œ ìŠ¤í¬ë¡¤ êµ¬í˜„
- ê° í•­ëª©: ì œëª© (ë˜ëŠ” ë¯¸ë¦¬ë³´ê¸°), ì—…ë°ì´íŠ¸ ì‹œê°„
- í´ë¦­ ì‹œ `/chat/:conversationId`ë¡œ ì´ë™
- í˜„ì¬ í™œì„± ëŒ€í™” í•˜ì´ë¼ì´íŠ¸

### 3.3 ì±„íŒ… í˜ì´ì§€

#### ìƒˆ ëŒ€í™” ìƒíƒœ (`/chat`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                               â”‚
â”‚                                               â”‚
â”‚                                               â”‚
â”‚              RAG.OS ë¡œê³  (í° ì‚¬ì´ì¦ˆ)            â”‚
â”‚                                               â”‚
â”‚           ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?                    â”‚
â”‚                                               â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚     â”‚ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...        [ì „ì†¡] â”‚      â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                               â”‚
â”‚   [ğŸ“ íŒŒì¼]  [ğŸŒ ì›¹ ê²€ìƒ‰]                      â”‚
â”‚                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ê¸°ì¡´ ëŒ€í™” ìƒíƒœ (`/chat/:conversationId`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ëŒ€í™” ì œëª©                      [ê³µìœ ] [ì‚­ì œ]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ ğŸ‘¤ ì‚¬ìš©ì ë©”ì‹œì§€                 â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                               â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚          â”‚ ğŸ¤– AI ì‘ë‹µ (ë§ˆí¬ë‹¤ìš´ ë Œë”ë§)     â”‚   â”‚
â”‚          â”‚                                â”‚   â”‚
â”‚          â”‚ ğŸ“ ì¶œì²˜: document.pdf (p.3)     â”‚   â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ ğŸ‘¤ í›„ì† ì§ˆë¬¸                     â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                               â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚          â”‚ ğŸ¤– ìŠ¤íŠ¸ë¦¬ë° ì¤‘... â–ˆ             â”‚   â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...         [ì „ì†¡]  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  [ğŸ“ íŒŒì¼]  [ğŸŒ ì›¹ ê²€ìƒ‰]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 SSE ìŠ¤íŠ¸ë¦¬ë° êµ¬í˜„

#### `useChat` ì»¤ìŠ¤í…€ í›…

```typescript
interface UseChatReturn {
  messages: Message[]
  isStreaming: boolean
  sendMessage: (content: string, options?: ChatOptions) => Promise<void>
  stopStreaming: () => void
  error: Error | null
}

interface ChatOptions {
  conversationId?: string
  useWebSearch?: boolean
}
```

#### SSE íŒŒì‹± ë¡œì§

```typescript
// POST /api/v1/chat/streamìœ¼ë¡œ SSE ì—°ê²°
// Content-Type: text/event-stream

// ì´ë²¤íŠ¸ ì²˜ë¦¬ ìˆœì„œ:
// 1. token â†’ ì‘ë‹µ í…ìŠ¤íŠ¸ ì²­í¬ (ì ì§„ì  ë Œë”ë§)
// 2. tool_call â†’ ë„êµ¬ í˜¸ì¶œ í‘œì‹œ (ì›¹ ê²€ìƒ‰ ì¤‘...)
// 3. tool_result â†’ ë„êµ¬ ê²°ê³¼ (ê²€ìƒ‰ ê²°ê³¼ ìš”ì•½)
// 4. done â†’ ì™„ë£Œ (conversation_id, sources í¬í•¨)
// 5. error â†’ ì—ëŸ¬ ì²˜ë¦¬
```

**êµ¬í˜„ ì£¼ì˜ì‚¬í•­:**
- `fetch` API ì‚¬ìš© (SSEëŠ” POST ìš”ì²­ì´ë¯€ë¡œ `EventSource` ì‚¬ìš© ë¶ˆê°€)
- `ReadableStream`ìœ¼ë¡œ ìŠ¤íŠ¸ë¦¼ ë°ì´í„° íŒŒì‹±
- `AbortController`ë¡œ ìŠ¤íŠ¸ë¦¬ë° ì¤‘ë‹¨ ê¸°ëŠ¥
- ìŠ¤íŠ¸ë¦¬ë° ì¤‘ ë©”ì‹œì§€ ì˜ì—­ ìë™ ìŠ¤í¬ë¡¤

### 3.5 ë©”ì‹œì§€ ë Œë”ë§

#### ë©”ì‹œì§€ ì»´í¬ë„ŒíŠ¸

```typescript
interface Message {
  id: string
  role: 'user' | 'assistant' | 'system'
  content: string
  sources?: string[]
  isStreaming?: boolean
  createdAt: string
}
```

**AI ì‘ë‹µ ë Œë”ë§:**
- `react-markdown` + `remark-gfm`ìœ¼ë¡œ ë§ˆí¬ë‹¤ìš´ ë Œë”ë§
- ì½”ë“œ ë¸”ë¡: êµ¬ë¬¸ í•˜ì´ë¼ì´íŠ¸ + ë³µì‚¬ ë²„íŠ¼
- ì¶œì²˜(Citation): ì†ŒìŠ¤ ëª©ë¡ í•˜ë‹¨ í‘œì‹œ
- ìŠ¤íŠ¸ë¦¬ë° ì¤‘: ì»¤ì„œ ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜

### 3.6 ë©”ì‹œì§€ ì…ë ¥ ì˜ì—­

```typescript
interface ChatInputProps {
  onSend: (message: string) => void
  isStreaming: boolean
  disabled?: boolean
}
```

**ê¸°ëŠ¥:**
- `Enter`: ì „ì†¡, `Shift+Enter`: ì¤„ë°”ê¿ˆ
- í…ìŠ¤íŠ¸ ì…ë ¥ ì‹œ `textarea` ìë™ ë†’ì´ ì¡°ì ˆ (ìµœëŒ€ 6ì¤„)
- ìŠ¤íŠ¸ë¦¬ë° ì¤‘: ì „ì†¡ ë²„íŠ¼ â†’ ì¤‘ì§€ ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½
- ë¹ˆ ë©”ì‹œì§€ ì „ì†¡ ë°©ì§€
- íŒŒì¼ ì²¨ë¶€ ë²„íŠ¼ (Phase 4ì—ì„œ ê¸°ëŠ¥ êµ¬í˜„)
- ì›¹ ê²€ìƒ‰ í† ê¸€ ë²„íŠ¼

### 3.7 ëŒ€í™” ëª©ë¡ ê´€ë¦¬

```typescript
// TanStack Query í›…
function useConversations() {
  return useInfiniteQuery({
    queryKey: ['conversations'],
    queryFn: ({ pageParam }) => fetchConversations({ cursor: pageParam }),
    getNextPageParam: (lastPage) => lastPage.has_next ? lastPage.next_cursor : undefined,
    initialPageParam: undefined,
  })
}
```

**ëŒ€í™” ëª©ë¡ ì—…ë°ì´íŠ¸:**
- ìƒˆ ëŒ€í™” ìƒì„± ì‹œ: ëª©ë¡ ìƒë‹¨ì— ì¶”ê°€ (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)
- ëŒ€í™”ì— ë©”ì‹œì§€ ì¶”ê°€ ì‹œ: í•´ë‹¹ ëŒ€í™”ë¥¼ ëª©ë¡ ìƒë‹¨ìœ¼ë¡œ ì´ë™
- ëŒ€í™” ì‚­ì œ ì‹œ: ëª©ë¡ì—ì„œ ì œê±°

## ì™„ë£Œ ê¸°ì¤€

- [ ] ì‚¬ì´ë“œë°” + ë©”ì¸ ì½˜í…ì¸  ë ˆì´ì•„ì›ƒ ë Œë”ë§
- [ ] ì‚¬ì´ë“œë°” í† ê¸€ (ë°ìŠ¤í¬í†±: ì ‘ê¸°/í¼ì¹˜ê¸°, ëª¨ë°”ì¼: ì˜¤ë²„ë ˆì´)
- [ ] ëŒ€í™” ëª©ë¡ ë¬´í•œ ìŠ¤í¬ë¡¤ ë™ì‘
- [ ] ìƒˆ ëŒ€í™” ìƒì„± ë° ëŒ€í™” ì „í™˜
- [ ] SSE ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ AI ì‘ë‹µ ì‹¤ì‹œê°„ ë Œë”ë§
- [ ] ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ (ì½”ë“œ ë¸”ë¡, í…Œì´ë¸”, ë¦¬ìŠ¤íŠ¸ ë“±)
- [ ] ìŠ¤íŠ¸ë¦¬ë° ì¤‘ë‹¨ ê¸°ëŠ¥
- [ ] ì›¹ ê²€ìƒ‰ ë„êµ¬ í˜¸ì¶œ ìƒíƒœ í‘œì‹œ
- [ ] ë©”ì‹œì§€ ì˜ì—­ ìë™ ìŠ¤í¬ë¡¤
- [ ] ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ (ë°ìŠ¤í¬í†±/íƒœë¸”ë¦¿/ëª¨ë°”ì¼)
