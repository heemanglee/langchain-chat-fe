# Phase 4: 문서 관리 + 폴더 관리

## 목표

문서 업로드/조회/삭제 기능, 폴더 CRUD, 폴더-문서 관계 관리를 구현한다. 사이드바의 LIBRARY 및 AGENTS 섹션을 활성화한다.

> **주의:** 이 Phase의 API는 백엔드에서 아직 구현 중이거나, 향후 `openapi.json`에 추가될 예정이다. 타입 정의를 먼저 작성하고, Mock API로 UI를 선 개발한 뒤 실제 API 연동으로 전환한다.

## 의존 API

### 문서 관리

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/api/v1/documents` | 문서 업로드 (multipart/form-data) |
| GET | `/api/v1/documents` | 문서 목록 조회 |
| GET | `/api/v1/documents/{id}` | 문서 상세 조회 |
| DELETE | `/api/v1/documents/{id}` | 문서 삭제 (Soft Delete) |
| GET | `/api/v1/documents/{id}/status` | 처리 상태 조회 |
| POST | `/api/v1/documents/{id}/reprocess` | 문서 재처리 |

### 폴더 관리

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/api/v1/folders` | 폴더 생성 |
| GET | `/api/v1/folders` | 폴더 목록 조회 |
| GET | `/api/v1/folders/{id}` | 폴더 상세 조회 |
| PATCH | `/api/v1/folders/{id}` | 폴더 수정 |
| DELETE | `/api/v1/folders/{id}` | 폴더 삭제 |
| POST | `/api/v1/folders/{id}/documents` | 폴더에 문서 추가 |
| DELETE | `/api/v1/folders/{id}/documents/{doc_id}` | 폴더에서 문서 제거 |

### 타입 정의

```typescript
// 문서
interface Document {
  id: number
  user_id: number
  folder_id: number | null
  type: 'LIBRARY' | 'ADHOC'
  filename: string
  file_path: string
  file_size: number
  mime_type: string
  checksum: string
  opensearch_index: string
  processing_status: 'PENDING' | 'PROCESSING' | 'INDEXED' | 'FAILED'
  processing_error: string | null
  chunk_count: number | null
  processed_at: string | null
  deleted_at: string | null
  created_at: string
  updated_at: string
}

// 폴더
interface Folder {
  id: number
  user_id: number
  name: string
  description: string | null
  instructions: string | null  // RAG 시스템 프롬프트
  created_at: string
  updated_at: string
}
```

## 작업 목록

### 4.1 사이드바 LIBRARY 섹션

사이드바의 LIBRARY 섹션을 활성화한다.

```
LIBRARY
├── 📁 모든 문서           ← 클릭 시 문서 라이브러리 뷰
├── 🕐 최근 업로드          ← 클릭 시 최근 업로드 필터
```

### 4.2 문서 라이브러리 뷰

메인 콘텐츠 영역에 문서 목록을 표시한다. (스크린샷 참조)

```
┌───────────────────────────────────────────────┐
│  최근 업로드 파일                    [⊕ 업로드]  │
├───────────────────────────────────────────────┤
│                                               │
│  ┌───────────────────────────────────────┐    │
│  │  📕 Q4_Result.pdf                     │    │
│  │     PDF • 2.4 MB          에이전트 생성됨│    │
│  └───────────────────────────────────────┘    │
│                                               │
│  ┌───────────────────────────────────────┐    │
│  │  📘 Tech_Spec.docx                   │    │
│  │     DOCX • 1.1 MB            처리 중...│    │
│  └───────────────────────────────────────┘    │
│                                               │
│  ┌─────────────────────────────────────────┐  │
│  │ 💡 제안: 'Q4_Result.pdf' 파일은           │  │
│  │    재무 리포트 디렉토리에 추가하시겠습니까?  │  │
│  └─────────────────────────────────────────┘  │
│                                               │
└───────────────────────────────────────────────┘
```

**문서 항목 정보:**
- 파일 아이콘: MIME 타입별 색상 (PDF: 빨강, DOCX: 파랑, TXT: 회색, MD: 초록)
- 파일명
- 파일 형식 + 크기
- 처리 상태 배지:
  - `PENDING`: "대기 중" (회색)
  - `PROCESSING`: "처리 중..." (파란색, 애니메이션)
  - `INDEXED`: "에이전트 생성됨" (초록색)
  - `FAILED`: "처리 실패" (빨간색, 재처리 버튼)

### 4.3 문서 업로드

#### 업로드 모달/드래그 앤 드롭

```
┌───────────────────────────────────────────┐
│              문서 업로드                     │
├───────────────────────────────────────────┤
│                                           │
│    ┌─────────────────────────────────┐    │
│    │                                 │    │
│    │    📁 파일을 드래그하거나         │    │
│    │       클릭하여 업로드            │    │
│    │                                 │    │
│    │    PDF, DOCX, TXT, MD           │    │
│    │                                 │    │
│    └─────────────────────────────────┘    │
│                                           │
│    문서 유형:  ◉ 라이브러리  ○ 일회용        │
│    폴더:      [선택 안 함      ▾]          │
│                                           │
│    ┌──────────┐   ┌──────────┐           │
│    │   취소    │   │   업로드   │           │
│    └──────────┘   └──────────┘           │
│                                           │
└───────────────────────────────────────────┘
```

**업로드 기능:**
- Drag & Drop 지원
- 파일 형식 제한: PDF, DOCX, TXT, MD
- 중복 파일 감지 시 덮어쓰기 확인 모달
- 업로드 진행률 표시
- 문서 유형 선택: LIBRARY (기본) / ADHOC
- 폴더 선택 (선택사항)

#### 중복 파일 덮어쓰기 확인

```
┌───────────────────────────────────────────┐
│              파일 중복 감지                  │
├───────────────────────────────────────────┤
│                                           │
│  'Q4_Result.pdf' 파일이 이미 존재합니다.    │
│  기존 파일을 덮어쓰시겠습니까?               │
│                                           │
│    ┌──────────┐   ┌──────────┐           │
│    │   취소    │   │  덮어쓰기  │           │
│    └──────────┘   └──────────┘           │
│                                           │
└───────────────────────────────────────────┘
```

### 4.4 문서 처리 상태 폴링

문서 업로드 후 처리 상태를 주기적으로 확인한다.

```typescript
// PENDING/PROCESSING 상태인 문서에 대해 5초 간격 폴링
function useDocumentStatus(documentId: number) {
  return useQuery({
    queryKey: ['document-status', documentId],
    queryFn: () => fetchDocumentStatus(documentId),
    refetchInterval: (query) => {
      const status = query.state.data?.processing_status
      return status === 'PENDING' || status === 'PROCESSING' ? 5000 : false
    },
  })
}
```

### 4.5 폴더 관리

#### 사이드바 FOLDERS 섹션

```
FOLDERS
├── 📂 재무 리포트          ← 클릭 시 폴더 내 문서/세션 표시
├── 📂 기술 문서            ← Drag & Drop으로 세션 이동
├── + 폴더 만들기           ← 인라인 폴더 생성
```

#### 폴더 생성 모달

```
┌───────────────────────────────────────────┐
│              폴더 만들기                    │
├───────────────────────────────────────────┤
│                                           │
│    폴더 이름:                               │
│    ┌─────────────────────────────────┐    │
│    │                                 │    │
│    └─────────────────────────────────┘    │
│                                           │
│    설명 (선택):                             │
│    ┌─────────────────────────────────┐    │
│    │                                 │    │
│    └─────────────────────────────────┘    │
│                                           │
│    에이전트 지시사항 (선택):                  │
│    ┌─────────────────────────────────┐    │
│    │ 이 폴더의 문서를 기반으로 답변할    │    │
│    │ 때 사용할 시스템 프롬프트...        │    │
│    └─────────────────────────────────┘    │
│                                           │
│    ┌──────────┐   ┌──────────┐           │
│    │   취소    │   │   생성    │           │
│    └──────────┘   └──────────┘           │
│                                           │
└───────────────────────────────────────────┘
```

#### 폴더-문서 관계

- 폴더 뷰에서 문서 추가/제거 기능
- 문서 라이브러리에서 폴더로 Drag & Drop

### 4.6 스마트 폴더 제안 배너

첫 번째 대화 후 폴더 이동을 제안하는 배너를 표시한다.

```
┌─────────────────────────────────────────────┐
│ 💡 제안: 'Q4_Result.pdf' 파일은               │
│    재무 리포트 디렉토리에 추가하시겠습니까?      │
│                            [무시] [추가하기]   │
└─────────────────────────────────────────────┘
```

### 4.7 에이전트 섹션

사이드바 AGENTS 섹션에 자동/수동 생성된 에이전트 목록을 표시한다.

```
AGENTS
├── 👤 마케팅 분석 봇      ← 클릭 시 해당 에이전트와 대화
├── 📄 계약서 검토 봇      ← 문서 기반 자동 생성 에이전트
├── + 에이전트 만들기       ← 커스텀 에이전트 생성
```

## 완료 기준

- [ ] 문서 라이브러리 뷰 렌더링 (스크린샷과 동일한 형태)
- [ ] 문서 업로드 (Drag & Drop + 클릭)
- [ ] 중복 파일 덮어쓰기 확인 모달
- [ ] 문서 처리 상태 실시간 업데이트 (폴링)
- [ ] 문서 삭제
- [ ] 폴더 CRUD
- [ ] 폴더에 문서 추가/제거
- [ ] 사이드바 LIBRARY/AGENTS/FOLDERS 섹션 동작
- [ ] 스마트 폴더 제안 배너
- [ ] 파일 형식별 아이콘 및 색상 표시
